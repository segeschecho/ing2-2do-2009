\chapter{Arquitectura}

Para satisfacer los nuevos requerimientos que surgieron en esta nueva etapa, se tuvieron que hacer diferentes modificaciones a la arquitectura que se tenía anteriormente. Estas modificaciones consistieron en su mayoría en el agregado de nuevos componentes para realizar las nuevas funciones impuestas, y en menor medida, se amplio la funcionalidad de alguno de los módulos ya existentes. Si bien estas modificaciones no fueron grandes, tuvo una repercusión importante ya que el comportamiento del sistema cambio en gran medida.

Para solucionar el problema de las regiones y los gobiernos provinciales, se pensó la arquitectura para que contemple los nuevos requerimientos de la siguiente forma:

\begin{itemize}
\item Dentro de una región, pueden existir varias provincias, por ende varios gobiernos provinciales.

\item Cada provincia, tiene una $Estacion$ $Central$ que toma y procesa los datos de la misma.

\item Los modelos pertenecientes a los gobiernos provinciales, podrán procesar los datos de las Tr's dentro de su región pero deberán suscribirse a estaciones centrales de otras regiones en caso de necesitar datos que son sensadas por estas últimas.
\item Finalmente cualquier estación central podrá comunicarse con otra para solicitar resultados parciales de acuerdo a su conveniencia.
\end{itemize}

\begin{figure}[h]
\centering
\includegraphics[scale=0.4]{regionProvincia.png}
\end{figure}

De ésta forma, se tiene un mejor control de los datos y los modelos de las diferentes provincias, además de distribuir la ejecución de una misma región.

La comunicación entre $Estaciones$ $Centrales$ pude realizarse por diferentes medios de comunicación, ya sea por gsm o por internet por ejemplo y eso estará descripto en la descripción de funcionalidad del componente responsable de esa comunicación. Esta comunicación se realizará mediante mensajes de control que permitan a una Estación central, pedir resultados parciales de un modelo, o pedir información de ciertos sensores a otras Estaciones Centrales regionales.

\section{Estructura}

Para poder cumplir con estos requerimientos, como se dijo se deberán agregar estaciones centrales de forma distribuida a lo largo de todo el país.
Pero con la restricción de que exista a lo sumo una por provincia. Sumado a esto cada una de estas EC provinciales (ECP), tendrán un sistema de
monitoreo (SMP) muy parecido al original, sólo que tendrá las componentes fundamentales, las que son pertinentes al manejo provincial.

Esto no cambia, sin embargo, que exista una estación central con todas las funcionalidades originales y también su sistema de monitoreo correspondiente.

Otro gran cambio que se realiza en cuanto a la forma de obtención de datos de una TR es que la EC o ECP que necesite los datos de dicha TR tendrá que
suscribirse y estas cada vez que tengan un nuevo dato lo enviarán a todos los suscriptos (publish/subscribe).
Este mecanismo tiene el limite del control provincial, las ECP sólo se podrán suscribir a las TR que estén en la región de la provincia. Si llegaran a necesitar
un dato de una TR en la misma región pero en otra provincia, deberán suscribirse a los datos de dicha TR a través de la ECP que los controle.

El mecanismo de suscripción y publicación de datos en una TR y en una EC o ECP serán polimorficos, logrando de esta forma transparencia a la hora de notificar
y/o suscribirse a los datos.

Otro detalle importante en cuanto a la suscripción de estos datos, se podrán hacer pidiendo un subconjunto de los sensores que posea la TR correspondiente.
Esta a su vez sabrá responder que tipo de sensores tiene presentes.

El último cambio que se realiza es que no sólo se podrá una ECP suscribir a otra para pedir datos de alguna TR en su provincia con ciertos sensores, si no 
que también se podrá suscribir a datos parcial o totalmente calculados por un modelo en la EC o ECP.


